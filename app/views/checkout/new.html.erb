<% content_for :body_class, "orange-bg" %>

<header class="home-header">
  <div class="home-header-left">
    <div class="home-header-logo">
      <img src="/Logo.png" alt="Raype Logo" class="header-logo-img">
    </div>
    <h1>RAYPE</h1>
  </div>
  <nav class="home-nav">
    <%= link_to "Voltar", root_path, class: "home-nav-btn" %>
  </nav>
</header>

<div class="checkout-container">
  <h1 class="checkout-title">Finalizar Pagamento</h1>

  <div class="checkout-layout">
    <!-- Resumo do Pedido -->
    <div class="checkout-summary">
      <div class="checkout-summary-card">
        <h3 class="checkout-summary-title">
          <i class="fas fa-receipt"></i>
          Resumo do Pedido
        </h3>

        <div class="checkout-summary-items">
          <div class="checkout-summary-item">
            <span class="checkout-summary-label">Outdoor:</span>
            <span class="checkout-summary-value"><%= @outdoor.outdoor_type&.titleize %></span>
          </div>

          <div class="checkout-summary-item">
            <span class="checkout-summary-label">Localiza√ß√£o:</span>
            <span class="checkout-summary-value"><%= @outdoor.outdoor_location %></span>
          </div>

          <div class="checkout-summary-item">
            <span class="checkout-summary-label">Per√≠odo:</span>
            <span class="checkout-summary-value">
              <%= format_checkout_period(@checkout_data[:start_date], @checkout_data[:end_date]) %>
            </span>
          </div>

          <div class="checkout-summary-item">
            <span class="checkout-summary-label">Dura√ß√£o:</span>
            <span class="checkout-summary-value">
              <%= @checkout_data[:quantity_months] %> <%= pluralize_checkout_months(@checkout_data[:quantity_months]) %>
            </span>
          </div>

          <% if @outdoor.art_quantity > 0 %>
            <div class="checkout-summary-item">
              <span class="checkout-summary-label">Artes Gr√°ficas:</span>
              <span class="checkout-summary-value">
                <%= @outdoor.art_quantity %> <%= pluralize_checkout_arts(@outdoor.art_quantity) %>
              </span>
            </div>
          <% end %>
        </div>

        <div class="checkout-summary-divider"></div>

        <div class="checkout-summary-total">
          <span class="checkout-summary-total-label">Valor Total</span>
          <span class="checkout-summary-total-value">
            <%= format_checkout_currency(@checkout_data[:total_amount]) %>
          </span>
        </div>
      </div>
    </div>

    <!-- M√©todos de Pagamento -->
    <div class="checkout-payment">
      <div class="checkout-payment-card">
        <h3 class="checkout-payment-title">
          <i class="fas fa-credit-card"></i>
          Escolha o M√©todo de Pagamento
        </h3>

        <%= form_with url: create_payment_path, method: :post, id: "payment-form", data: { turbo: false } do |f| %>
          <%= hidden_field_tag :payment_method, '', id: 'selected-payment-method' %>
          <%= hidden_field_tag :payment_type, '', id: 'selected-payment-type' %>
          <%= hidden_field_tag :installments, 1, id: 'selected-installments' %>

          <% max_installments = @checkout_data[:quantity_months].to_i %>

          <!-- PIX ou Boleto Banc√°rio -->
          <div class="payment-method-card" data-method="PIX_BOLETO">
            <div class="payment-method-header">
              <div class="payment-method-icon pix-boleto-icon">
                <i class="fas fa-qrcode"></i>
                <i class="fas fa-barcode"></i>
              </div>
              <div class="payment-method-info">
                <h4 class="payment-method-name">PIX ou Boleto Banc√°rio</h4>
                <p class="payment-method-desc">Escolha √† vista ou parcelado</p>
              </div>
            </div>
            <div class="payment-method-badge instant-badge">Aprova√ß√£o r√°pida</div>

            <!-- Op√ß√µes: √Ä Vista ou Parcelado (SEM escolher PIX/Boleto - Asaas decide) -->
            <div class="installments-container hidden-data" id="pix-boleto-options">
              <!-- Op√ß√µes de Pagamento: √Ä Vista ou Parcelado -->
              <div class="payment-mode-selector">
                <h4 class="payment-mode-title">Como deseja pagar?</h4>
                <div class="payment-mode-options">
                  <!-- √Ä Vista -->
                  <div class="payment-mode-card active" data-mode="avista" data-payment-type="pix-boleto">
                    <div class="payment-mode-icon">
                      <i class="fas fa-money-bill-wave"></i>
                    </div>
                    <div class="payment-mode-content">
                      <h5>√Ä Vista</h5>
                      <p class="payment-mode-value"><%= format_installment_value(@checkout_data[:total_amount]) %></p>
                      <span class="payment-mode-benefit">Pagamento √∫nico ‚Ä¢ PIX ou Boleto</span>
                    </div>
                    <div class="payment-mode-check">
                      <i class="fas fa-check-circle"></i>
                    </div>
                  </div>

                  <!-- Parcelado -->
                  <div class="payment-mode-card" data-mode="parcelado" data-payment-type="pix-boleto">
                    <div class="payment-mode-icon">
                      <i class="fas fa-calendar-alt"></i>
                    </div>
                    <div class="payment-mode-content">
                      <h5>Parcelado</h5>
                      <p class="payment-mode-value">At√© <%= max_installments %>x</p>
                      <span class="payment-mode-benefit">Parcelas mensais ‚Ä¢ Boleto</span>
                    </div>
                    <div class="payment-mode-check">
                      <i class="fas fa-check-circle"></i>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Grid de Parcelas -->
              <div class="installments-grid-container hidden-data" id="pix-boleto-installments-grid">
                <h4 class="installments-grid-title">
                  <i class="fas fa-hand-pointer"></i>
                  Escolha a quantidade de parcelas
                </h4>
                <div class="installments-grid-modern">
                  <% (1..max_installments).each do |i| %>
                    <% installment_value = calculate_installment_value(@checkout_data[:total_amount], i) %>
                    <div class="installment-card" data-installments="<%= i %>" data-payment-type="pix-boleto">
                      <div class="installment-number"><%= i %>x</div>
                      <div class="installment-value"><%= format_installment_value(installment_value) %></div>
                      <div class="installment-total">Total: <%= format_installment_value(@checkout_data[:total_amount]) %></div>
                      <div class="installment-check"><i class="fas fa-check"></i></div>
                    </div>
                  <% end %>
                </div>
              </div>
            </div>
          </div>

          <!-- Cart√£o -->
          <div class="payment-method-card" data-method="CARD">
            <div class="payment-method-header">
              <div class="payment-method-icon card-icon">
                <i class="fas fa-credit-card"></i>
              </div>
              <div class="payment-method-info">
                <h4 class="payment-method-name">Cart√£o de Cr√©dito ou D√©bito</h4>
                <p class="payment-method-desc">Processado pelo Asaas</p>
              </div>
            </div>
            <div class="payment-method-badge credit-badge">Aprova√ß√£o imediata</div>

            <!-- Sem op√ß√µes adicionais - Asaas decide tudo -->
            <div class="installments-container hidden-data" id="card-options">
              <div class="card-info-notice">
                <i class="fas fa-info-circle"></i>
                <p><strong>Voc√™ ser√° redirecionado para o Asaas</strong> onde poder√° escolher entre:</p>
                <ul>
                  <li>üí≥ Cart√£o de Cr√©dito (com op√ß√µes de parcelamento)</li>
                  <li>üí∞ Cart√£o de D√©bito (pagamento √† vista)</li>
                </ul>
                <p class="card-security"><i class="fas fa-lock"></i> Ambiente seguro e criptografado</p>
              </div>
            </div>
          </div>

          <!-- Bot√£o de Confirmar -->
          <button type="submit" class="checkout-submit-btn" id="checkout-submit" disabled>
            <i class="fas fa-lock"></i>
            Confirmar Pagamento
          </button>

          <div class="checkout-security-note">
            <i class="fas fa-shield-halved"></i>
            <p>Pagamento processado de forma 100% segura atrav√©s do Asaas</p>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>

