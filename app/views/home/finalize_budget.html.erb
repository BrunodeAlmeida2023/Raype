<% content_for :body_class, "orange-bg" %>

<header class="home-header">
  <div class="home-header-left">
    <div class="home-header-logo">
      <img src="/Logo.png" alt="Raype Logo" class="header-logo-img">
    </div>
    <h1>RAYPE</h1>
  </div>
  <nav class="home-nav">
    <%= link_to "Voltar", root_path, class: "home-nav-btn" %>
  </nav>
</header>

<%= form_with url: post_finalize_budget_home_path, method: :post, class: "home-form-container", id: "finalize-budget-form", data: { turbo: false} do |f| %>
  <div class="budget-container">
    <h1 class="home-services-title">Resumo do Orçamento</h1>

    <%
      # Cálculos
      start_date = @outdoor.selected_start_date
      quantity_months = @outdoor.selected_quantity_month.to_i
      end_date = start_date + quantity_months.months if start_date.present?

      valor_por_mes = 1200
      valor_por_arte = 600

      total_outdoor = quantity_months * valor_por_mes
      total_grafica = @outdoor.art_quantity.to_i * valor_por_arte
      total_geral = total_outdoor + total_grafica
    %>

    <div class="budget-layout">
      <!-- Lado Esquerdo: Detalhes -->
      <div class="budget-details">
        <!-- Card: Outdoor -->
        <div class="budget-card">
          <div class="budget-card-header">
            <i class="fas fa-rectangle-ad budget-card-icon"></i>
            <h3>Outdoor Selecionado</h3>
          </div>
          <div class="budget-card-body">
            <div class="budget-info-row">
              <span class="budget-label">Tipo:</span>
              <span class="budget-value"><%= @outdoor.outdoor_type&.titleize %></span>
            </div>
            <div class="budget-info-row">
              <span class="budget-label">Tamanho:</span>
              <span class="budget-value"><%= @outdoor.outdoor_size %></span>
            </div>
            <div class="budget-info-row">
              <span class="budget-label">Local:</span>
              <span class="budget-value"><%= @outdoor.outdoor_location %></span>
            </div>
          </div>
        </div>

        <!-- Card: Período -->
        <div class="budget-card">
          <div class="budget-card-header">
            <i class="fas fa-calendar-days budget-card-icon"></i>
            <h3>Período de Veiculação</h3>
          </div>
          <div class="budget-card-body">
            <div class="budget-info-row">
              <span class="budget-label">Data Inicial:</span>
              <span class="budget-value"><%= start_date&.strftime('%d/%m/%Y') %></span>
            </div>
            <div class="budget-info-row">
              <span class="budget-label">Data Final:</span>
              <span class="budget-value"><%= end_date&.strftime('%d/%m/%Y') %></span>
            </div>
            <div class="budget-info-row">
              <span class="budget-label">Duração:</span>
              <span class="budget-value highlight"><%= quantity_months %> <%= quantity_months == 1 ? 'mês' : 'meses' %></span>
            </div>
          </div>
        </div>

        <!-- Card: Artes Gráficas -->
        <div class="budget-card">
          <div class="budget-card-header">
            <i class="fas fa-palette budget-card-icon"></i>
            <h3>Artes Gráficas</h3>
          </div>
          <div class="budget-card-body">
            <div class="budget-info-row">
              <span class="budget-label">Quantidade de Artes:</span>
              <span class="budget-value"><%= @outdoor.art_quantity %> <%= @outdoor.art_quantity == 1 ? 'arte' : 'artes' %></span>
            </div>
            <% if @outdoor.art_quantity > 0 %>
              <div class="budget-info-row">
                <span class="budget-label">Valor por Arte:</span>
                <span class="budget-value">R$ <%= number_with_delimiter(valor_por_arte, delimiter: '.') %>,00</span>
              </div>
              <div class="budget-arts-preview">
                <% @outdoor.art_files.each_with_index do |art, index| %>
                  <div class="budget-art-thumb">
                    <%= image_tag art, alt: "Arte #{index + 1}" %>
                  </div>
                <% end %>
              </div>
            <% else %>
              <div class="budget-info-note">
                <i class="fas fa-info-circle"></i>
                <p>Artes serão criadas pela nossa equipe de design</p>
              </div>
            <% end %>
          </div>
        </div>
      </div>

      <!-- Lado Direito: Totais -->
      <div class="budget-summary">
        <div class="budget-summary-card">
          <h3 class="budget-summary-title">Valores</h3>

          <div class="budget-summary-items">
            <!-- Outdoor -->
            <div class="budget-summary-item">
              <div class="budget-summary-item-header">
                <span class="budget-summary-label">Outdoor (<%= quantity_months %> <%= quantity_months == 1 ? 'mês' : 'meses' %>)</span>
                <span class="budget-summary-calc"><%= quantity_months %> × R$ <%= number_with_delimiter(valor_por_mes, delimiter: '.') %></span>
              </div>
              <div class="budget-summary-value">
                R$ <%= number_with_delimiter(total_outdoor, delimiter: '.') %>,00
              </div>
            </div>

            <!-- Gráfica -->
            <div class="budget-summary-item">
              <div class="budget-summary-item-header">
                <span class="budget-summary-label">Gráfica (<%= @outdoor.art_quantity %> <%= @outdoor.art_quantity == 1 ? 'arte' : 'artes' %>)</span>
                <span class="budget-summary-calc"><%= @outdoor.art_quantity %> × R$ <%= number_with_delimiter(valor_por_arte, delimiter: '.') %></span>
              </div>
              <div class="budget-summary-value">
                R$ <%= number_with_delimiter(total_grafica, delimiter: '.') %>,00
              </div>
            </div>
          </div>

          <div class="budget-summary-divider"></div>

          <!-- Total Geral -->
          <div class="budget-summary-total">
            <span class="budget-summary-total-label">Total</span>
            <span class="budget-summary-total-value">
              R$ <%= number_with_delimiter(total_geral, delimiter: '.') %>,00
            </span>
          </div>

          <%= hidden_field_tag :outdoor_id, @outdoor.id %>
          <%= hidden_field_tag :selected_start_date, @outdoor.selected_start_date %>
          <%= hidden_field_tag :selected_quantity_month, @outdoor.selected_quantity_month %>
          <%= hidden_field_tag :total_amount, total_geral %>
          <!-- Botão de Pagamento -->
          <div class="budget-summary-actions">
            <%= f.submit "Pagar Agora", class: "budget-pay-btn" %>
          </div>

          <!-- Info adicional -->
          <div class="budget-summary-note">
            <i class="fas fa-shield-halved"></i>
            <p>Pagamento 100% seguro</p>
          </div>
        </div>
      </div>
    </div>
  </div>
<% end %>
